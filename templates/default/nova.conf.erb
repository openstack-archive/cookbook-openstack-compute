# This file autogenerated by Chef
# Do not edit, changes will be overwritten
<% if not node["custom_template_banner"].nil? %>
<%= node["custom_template_banner"] %>
<% end %>
[DEFAULT]

# LOGS/STATE
verbose=true
auth_strategy=keystone
dhcpbridge_flagfile=/etc/nova/nova.conf
dhcpbridge=/usr/bin/nova-dhcpbridge
logdir=/var/log/nova
<% if @use_syslog == true %>
use_syslog=<%= @use_syslog %>
syslog_log_facility=<%= @log_facility %>
<% end %>
state_path=/var/lib/nova
lock_path=/var/lock/nova

##### RABBITMQ #####
rabbit_password=guest
rabbit_port=5672
rabbit_host=<%= @rabbit_ipaddress %>

##### SCHEDULER #####
# scheduler_manager=nova.scheduler.manager.SchedulerManager
scheduler_driver=<%= @scheduler_driver %>
scheduler_available_filters=nova.scheduler.filters.standard_filters
# which filter class names to use for filtering hosts when not specified in the request.
scheduler_default_filters=<%= @scheduler_default_filters %>
node_availability_zone=<%= @availability_zone %>
default_schedule_zone=<%= @default_schedule_zone %>

##### NETWORK #####
network_manager=<%= @network_manager %>
#--flat_interface=eth1
#--flat_network_dhcp_start=10.20.1.2
#--public_interface=eth0
fixed_range=<%= @fixed_range %>
dmz_cidr=<%= @dmz_cidr %>
force_dhcp_release=true
send_arp_for_ha=True
<% if @virt_type == "qemu" -%>
libvirt_use_virtio_for_bridges=false
<% else -%>
libvirt_use_virtio_for_bridges=true
<% end -%>

##### GLANCE #####
image_service=nova.image.glance.GlanceImageService
glance_api_servers=<%= @glance_api_ipaddress %>:<%= @glance_api_port %>

##### COMPUTE #####
compute_manager=nova.compute.manager.ComputeManager
sql_connection=mysql://<%= @user %>:<%= @passwd %>@<%= @db_ipaddress %>/<%= @db_name %>
connection_type=libvirt
libvirt_type=<%= @virt_type %>
root_helper=sudo nova-rootwrap
remove_unused_base_images=true
remove_unused_original_minimum_age_seconds=360

##### VNCPROXY #####
<% if @novncproxy_base_url -%>
novncproxy_base_url=<%= @novncproxy_base_url %>
<% end -%>
<% if @xvpvncproxy_base_url -%>
xvpvncproxy_base_url=<%= @xvpvncproxy_base_url %>
<% end -%>
# This is only required on the server running xvpvncproxy
<% if @xvpvncproxy_bind_host -%>
xvpvncproxy_host=<%= @xvpvncproxy_bind_host %>
<% end -%>
<% if @xvpvncproxy_bind_port -%>
xvpvncproxy_port=<%= @xvpvncproxy_bind_port %>
<% end -%>
<% if @vncserver_listen -%>
vncserver_listen=<%= @vncserver_listen %>
<% end -%>
<% if @vncserver_proxyclient_address -%>
vncserver_proxyclient_address=<%= @vncserver_proxyclient_address %>
<% end -%>

##### MISC #####
# force backing images to raw format
force_raw_images=<%= @force_raw_images %>
allow_same_net_traffic=<%= @allow_same_net_traffic %>
osapi_max_limit=<%= @osapi_max_limit %>
snapshot_image_format=<%= @snapshot_image_format %>
start_guests_on_host_boot=<%= @start_guests_on_host_boot %>
resume_guests_state_on_host_boot=<%= @resume_guests_state_on_host_boot %>

<%- if /FilterScheduler/.match(@scheduler_driver) or
       /MultiScheduler/.match(@scheduler_driver) %>
# FilterScheduler Only Options
<%- if /ComputeFilter/.match(@scheduler_default_filters) %>
# virtual CPU to Physical CPU allocation ratio (default: 16.0)
cpu_allocation_ratio=<%= @cpu_allocation_ratio %>
<%- end %>
<%- if /RamFilter/.match(@scheduler_default_filters) %>
# virtual ram to physical ram allocation ratio (default: 1.5)
ram_allocation_ratio=<%= @ram_allocation_ratio %>
<%- end %>
<%- elsif /SimpleScheduler/.match(@scheduler_driver) %>
# SimpleScheduler Only Options
# maximum number of instance cores to allow per host
max_cores=<% @cpu_allocation_ratio.to_i * node["cpu"]["total"].to_i %>
<%- end %>

<% if node["platform"] == "fedora" -%>
# Adding support for non-modded euca2ools to display ip address info
# https://bugs.launchpad.net/nova/+bug/901594
ec2_private_dns_show_ip=True
<% end -%>

##### KEYSTONE #####
keystone_ec2_url=http://<%= @keystone_api_ipaddress %>:<%= @keystone_service_port %>/v2.0/ec2tokens

##### VOLUMES #####
# iscsi target user-land tool to use
iscsi_helper=<%= @iscsi_helper %>
